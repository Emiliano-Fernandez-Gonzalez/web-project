<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">    <title>Initial Setup</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@200..700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/utils.css" />

    <style>
        .day-lesson-name {
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
            line-height: 1.2em;
            margin-bottom: 4px;
            word-break: keep-all;
        }


    </style>
</head>
<body class="progress-page-body">
    <img src="../img/abstract-blue-fig.png" alt="" class="bg-shape shape-3">
    <img src="../img/abstract-blue-fig.png" alt="" class="bg-shape shape-4">
    <header class="navbar">
                <div class="logo">Languide</div>

                <div class="hamburger" id="hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>

                <nav class="nav-desktop">
                    <ul class="nav-links">
                        <li><a href="landing-page.html">Inicio</a></li>
                        <li><a href="#">Planes</a></li>
                        <li><a href="#">Idiomas</a></li>
                        <a href="#"><img src="../img/user-pic.png" alt="Imagen de perfil del usuario" class="user-pic"></a>
                    </ul>
                </nav>
        </header>
    <div class="nav-overlay" id="navOverlay"></div>

    <nav class="nav-mobile" id="mobileMenu">
        <ul>
            <a href="#"><img src="../img/user-pic.png" alt="Imagen de perfil del usuario" class="user-pic"></a>
            <li><a href="landing-page.html">Inicio</a></li>
            <li><a href="#">Planes</a></li>
            <li><a href="#">Idiomas</a></li>
        </ul>
    </nav>

    <main class="content">
        <div class="content-container">
            <div class="progress-status">
                <p class="container-title">Progreso</p>
                <div class="progress-info">
                    <div class="progress-container">
                        <div class="progress-bar" style="width: 74%;"></div>
                    </div>
                    <p class="progress-percentage">74%</p>
                </div>
            </div>
            <div class="progress-days">
                <div class="days">
                    <label class="day-lesson-name">Dia 1: Saludos</label>
                    <label class="day-lesson-name">Dia 2: Numeros</label>
                    <label class="day-lesson-name">Dia 3: Dias</label>
                    <label class="day-lesson-name">Dia 4: Comida</label>
                    <label class="day-lesson-name">Dia 5: Lugares</label>
                    <label class="day-lesson-name">Dia 6: Compras</label>
                    <label class="day-lesson-name">Dia 7: Animales</label>
                </div>
                <div class="days-statuses">
                    <div id="day-1" class="day-info">
                        <label class="day-status pendant">Pendiente</label>
                        <button class="play-lesson" onclick="startLesson(0)">▶</button>
                    </div>
                    <div id="day-2" class="day-info">
                        <label class="day-status pendant">Pendiente</label>
                        <button class="play-lesson" onclick="startLesson(1)">▶</button>
                    </div>
                    <div id="day-3" class="day-info">
                        <label class="day-status pendant">Pendiente</label>
                        <button class="play-lesson" onclick="startLesson(2)">▶</button>
                    </div>
                    <div id="day-4" class="day-info">
                        <label class="day-status pendant">Pendiente</label>
                        <button class="play-lesson" onclick="startLesson(3)">▶</button>
                    </div>
                    <div id="day-5" class="day-info">
                        <label class="day-status pendant">Pendiente</label>
                        <button class="play-lesson" onclick="startLesson(4)">▶</button>
                    </div>
                    <div id="day-6" class="day-info">
                        <label class="day-status pendant">Pendiente</label>
                        <button class="play-lesson" onclick="startLesson(5)">▶</button>
                    </div>
                    <div id="day-7" class="day-info">
                        <label class="day-status pendant">Pendiente</label>
                        <button class="play-lesson" onclick="startLesson(6)">▶</button>
                    </div>
                </div>
            </div>
            <a href="landing-page.html" class="btn-primary content-button">Cerrar sesión</a>


        </div>
    </main>
   <script>
        async function loadProgress() {
    try {
        const res = await fetch("../php/progress.php");
        const data = await res.json();

        if (!data.temario) return;

        const plan = data.temario.plan; 

     
        const progresoOriginal = data.progreso || {};
        const progreso = [];

        for (let i = 0; i < plan.length; i++) {
            progreso[i] = progresoOriginal[i] === true;
        }
      

        const dayInfoContainers = document.querySelectorAll(".day-info");
        const dayLabels = document.querySelectorAll(".day-lesson-name");

        plan.forEach((item, index) => {
            if (dayLabels[index]) {
                dayLabels[index].textContent = `Dia ${index + 1}: ${item.tema}`;
            }
            if (dayInfoContainers[index]) {
                const statusLabel = dayInfoContainers[index].querySelector(".day-status");
                if (statusLabel) {
                    statusLabel.textContent = progreso[index] ? "Completado" : "Pendiente";
                    statusLabel.className = "day-status " + (progreso[index] ? "done" : "pendant");
                }
            }
        });

       
        const completed = progreso.filter(d => d).length;
        const progressPercent = Math.round((completed / plan.length) * 100);

        const progressBar = document.querySelector(".progress-bar");
        const progressLabel = document.querySelector(".progress-percentage");

        if (progressBar) progressBar.style.width = `${progressPercent}%`;
        if (progressLabel) progressLabel.textContent = `${progressPercent}%`;

    } catch (err) {
        console.error("Error cargando el progreso:", err);
    }
}

        loadProgress();

        function startLesson(dayIndex) {
            sessionStorage.setItem("currentLesson", dayIndex);
            window.location.href = "question-page.html";
        }
    </script>


</body>
</html>
