<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">    <title>Initial Setup</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@200..700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/utils.css" />
</head>
<body class="question-page-body">
    <img src="../img/abstract-blue-fig.png" alt="" class="bg-shape shape-3">
    <img src="../img/abstract-blue-fig.png" alt="" class="bg-shape shape-4">

    <main class="content">
        <div class="content-container">
            <div class="progress-status question-progress">
                <p class="container-title">Ejercicio 1 de 3</p>
                <div class="progress-info">
                    <div class="progress-container">
                        <div class="progress-bar" style="width: 0%;"></div>
                    </div>
                </div>
            </div>
            <button class="exit-lesson-btn" onclick="cancelarLeccion()">✕</button>

            <p class="question">¿Cómo se traduce <em><strong>welcome</strong></em>?</p>
            <div class="answers">
            <button type="button" class="btn-secondary option">Bienvenido</button>
            <button type="button" class="btn-secondary option" onclick="window.location.href='wrong-answer.html'">Bien hecho</button>
            <button type="button" class="btn-secondary option" onclick="window.location.href='wrong-answer.html'">Bien dicho</button>
            </div>
            <button class="btn-primary content-button" id="send-btn">Enviar</button>
        </div>
    </main>
<script>
let preguntas = [];
let index = 0;
let selectedButton = null;

const preguntaText = document.querySelector(".question");
const progressLabel = document.querySelector(".container-title");
const progressBar = document.querySelector(".progress-bar");
const optionsContainer = document.querySelector(".answers");
const sendBtn = document.querySelector(".content-button");

fetch("../php/get_questions.php", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ day: sessionStorage.getItem("currentLesson") })
})
.then(r => r.json())
.then(data => {
    preguntas = data.preguntas;
    cargarPregunta();
})
.catch(err => console.error("Error cargando preguntas:", err));


function cargarPregunta() {
    const p = preguntas[index];

    selectedButton = null;

    preguntaText.innerHTML = p.pregunta;
    progressLabel.innerText = `Ejercicio ${index + 1} de 3`;

    optionsContainer.innerHTML = "";

    p.opciones.forEach(op => {
        const btn = document.createElement("button");
        btn.className = "btn-secondary option";
        btn.innerText = op;

        btn.onclick = () => {
            selectedButton = btn;

            document.querySelectorAll(".option").forEach(b => {
                b.classList.remove("selected", "correct", "wrong");
            });

            btn.classList.add("selected");
        };

        optionsContainer.appendChild(btn);
    });

    actualizarBarra();
}

function actualizarBarra() {
    const percent = Math.round((index / 3) * 100);
    progressBar.style.width = percent + "%";
}

sendBtn.onclick = () => {
    if (!selectedButton) return;

    const correcta = preguntas[index].correcta;

    document.querySelectorAll(".option").forEach(btn => {
        if (btn.innerText === correcta) {
            btn.classList.add("correct");
        }
    });

    if (selectedButton.innerText !== correcta) {
        selectedButton.classList.add("wrong");
        return;
    }

    setTimeout(() => {
        index++;

        if (index >= 3) {
            marcarDiaCompletado();
        } else {
            cargarPregunta();
        }
    }, 800);
};

function marcarDiaCompletado() {
    const day = sessionStorage.getItem("currentLesson");

    fetch("../php/markprogress.php", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ day })
    })
    .then(r => r.json())
    .then(() => {
        window.location.href = "progress-page.html";
    })
    .catch(err => console.error("Error guardando progreso:", err));
}
</script>


</body>
</html>
