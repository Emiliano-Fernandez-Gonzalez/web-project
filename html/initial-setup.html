<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">    <title>Initial Setup</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@200..700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/utils.css" />
</head>
<body class="initial-setup-body">
    <img src="../img/abstract-blue-fig.png" alt="" class="bg-shape shape-3">
    <img src="../img/abstract-blue-fig.png" alt="" class="bg-shape shape-4">
    <header>
        <nav class="nav-bar">
            <ul class="nav-elements">
                <li><a href="landing-page.html">Inicio</a></li>
                <li><a href="#">Planes</a></li>
                <li><a href="#">Idiomas</a></li>
                <a href="#"><img src="../img/user-pic.png" alt="Imagen de perfil del usuario" class="user-pic"></a>
            </ul>
        </nav>
    </header>

    <form action="../php/generate_plan.php" method="POST" id="setupForm">
        <main class="content">
            <div class="content-container">
                <p class="container-title centered">Configura tus objetivos de aprendizaje.</p>
                <label class="options-title">Lenguaje:</label>
                <div class="slider">
                    <button type="button" class="arrow left">◀</button>

                    <div class="slider-window">
                        <div class="slider-track">
                            <button type="button" class="btn-secondary option">
                                <img src="../img/english.png" alt="united-kingdom-flag" class="option-icon"> Inglés
                            </button>
                            <button type="button" class="btn-secondary option">
                                <img src="../img/french.png" alt="france-flag" class="option-icon"> Francés
                            </button>
                            <button type="button" class="btn-secondary option">
                                <img src="../img/spanish.png" alt="spain-flag" class="option-icon"> Español
                            </button>
                        </div>
                    </div>

                    <button type="button" class="arrow right">▶</button>
                </div>
                <div class="option-group" role="group">
                    <button type="button" class="btn-secondary option">
                        <img src="../img/english.png" alt="united-kingdom-flag" class="option-icon">
                        Inglés
                    </button>
                    <button type="button" class="btn-secondary option">
                        <img src="../img/french.png" alt="france-flag" class="option-icon">
                        Francés
                    </button>
                    <button type="button" class="btn-secondary option">
                        <img src="../img/spanish.png" alt="spain-flag" class="option-icon">
                        Español
                    </button>
                </div>
                <label class="options-title">Nivel:</label>
                <div class="slider">
                    <button type="button" class="arrow left">◀</button>

                    <div class="slider-window">
                        <div class="slider-track">
                            <button type="button" class="btn-secondary option">Básico</button>
                            <button type="button" class="btn-secondary option">Intermedio</button>
                            <button type="button" class="btn-secondary option">Avanzado</button>
                        </div>
                    </div>

                    <button type="button" class="arrow right">▶</button>
                </div>
                <div class="option-group" role="group">
                    <button type="button" class="btn-secondary option">Básico</button>
                    <button type="button" class="btn-secondary option">Intermedio</button>
                    <button type="button" class="btn-secondary option">Avanzado</button>
                </div>
                <label class="options-title">Objetivos:</label>
                <div class="slider">
                    <button type="button" class="arrow left">◀</button>

                    <div class="slider-window">
                        <div class="slider-track">
                            <button type="button" class="btn-secondary option">Viajes</button>
                            <button type="button" class="btn-secondary option">Negocios</button>
                            <button type="button" class="btn-secondary option">Educación</button>
                        </div>
                    </div>

                    <button class="arrow right">▶</button>
                </div>
                <div type="button" class="option-group" role="group">
                    <button type="button" class="btn-secondary option">Viajes</button>
                    <button type="button" class="btn-secondary option">Negocios</button>
                    <button type="button" class="btn-secondary option">Educación</button>
                </div>

                <input type="hidden" name="user_id" value="1" id="user_id">
                <input type="hidden" name="lenguaje" id="lenguaje">
                <input type="hidden" name="nivel" id="nivel">
                <input type="hidden" name="objetivo" id="objetivo">

                <a href="#" class="btn-primary content-button">Generar plan</a>
            </div>

        </main>
    </form>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const fieldMap = {
                "Lenguaje": "lenguaje",
                "Nivel": "nivel",
                "Objetivos": "objetivo"
            };

            function moveSlider(slider, index) {
                const track = slider.querySelector(".slider-track");
                track.style.transform = `translateX(-${index * 210}px)`;
                slider.dataset.index = index;
            }

            function syncButtons(group, text) {
                group.querySelectorAll(".option").forEach(btn => {
                    btn.classList.toggle("selected", btn.textContent.trim() === text);
                });
            }

            function updateHiddenField(sectionName, value) {
                const hiddenId = fieldMap[sectionName];
                if (hiddenId) {
                    document.getElementById(hiddenId).value = value;
                }
            }

            function findOptionIndex(slider, text) {
                const options = Array.from(slider.querySelectorAll(".slider-track > div"));

                return options.findIndex(option => {
                    const t = option.textContent.trim();
                    return t.includes(text) || t === text;
                });
            }

            document.querySelectorAll(".option-group").forEach(group => {
                group.addEventListener("click", e => {
                    const btn = e.target.closest(".option");
                    if (!btn) return;

                    const text = btn.textContent.trim();
                    const section = group.dataset.section;
                    const container = group.closest(".options-container");
                    const slider = container.querySelector(".slider");

                    syncButtons(group, text);

                    if (slider) {
                        const index = findOptionIndex(slider, text);
                        if (index !== -1) moveSlider(slider, index);
                    }

                    updateHiddenField(section, text);
                });
            });

            document.querySelectorAll(".slider").forEach(slider => {
                const track = slider.querySelector(".slider-track");
                const container = slider.closest(".options-container");
                const group = container.querySelector(".option-group");
                const section = group.dataset.section;

                let index = 0;
                const total = track.children.length;

                const updateMobile = () => {
                    const text = track.children[index].textContent.trim();

                    moveSlider(slider, index);
                    syncButtons(group, text);
                    updateHiddenField(section, text);
                };

                slider.querySelector(".left").addEventListener("click", () => {
                    index = (index - 1 + total) % total;
                    updateMobile();
                });

                slider.querySelector(".right").addEventListener("click", () => {
                    index = (index + 1) % total;
                    updateMobile();
                });
            });
        });
    </script>
</body>
</html>
